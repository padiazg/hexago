{{/*
Template: project/root_cmd.go
Description: Root Cobra command with configuration initialization
Variables:
  - Year: string - Copyright year
  - Author: string - Author name
  - ProjectName: string - Project name
  - ModuleName: string - Go module name
  - CoreLogic: string - Core logic directory name (services/usecases)
*/}}
/*
Copyright Â© {{.Year}} {{.Author}}
*/
package cmd

import (
	"{{.ModuleName}}/internal/config"
	"{{.ModuleName}}/pkg/logger"
	"github.com/spf13/cobra"
)

var (
	cfgFile string
	cfg     *config.Config
	log     logger.Logger
)

// rootCmd represents the base command when called without any subcommands
var rootCmd = &cobra.Command{
	Use:   "{{.ProjectName}}",
	Short: "{{.ProjectName}} - Built with hexagonal architecture",
	Long: `{{.ProjectName}} application generated by HexaGo.

This application follows Hexagonal Architecture (Ports & Adapters) pattern,
ensuring proper separation of concerns and maintainability.

Architecture layers:
  - Core Domain: Pure business logic and entities
  - {{.CoreLogic}}: Application business logic orchestration
  - Adapters: External interfaces (HTTP, database, etc.)
  - Infrastructure: Cross-cutting concerns (config, logging, etc.)`,
}

// Execute adds all child commands to the root command and sets flags appropriately.
// This is called by main.main(). It only needs to happen once to the rootCmd.
func Execute() error {
	return rootCmd.Execute()
}

func init() {
	cobra.OnInitialize(initConfig)

	// Persistent flags
	rootCmd.PersistentFlags().StringVar(&cfgFile, "config", "", "config file (default is .{{.ProjectName}}.yaml)")
}

// initConfig reads in config file and ENV variables if set.
func initConfig() {
	var err error
	cfg, err = config.Load(cfgFile)
	if err != nil {
		logger.Fatal("Failed to load configuration: %v", err)
	}

	// Initialize logger from config
	log = logger.New(&logger.Config{
		Level:  cfg.LogLevel,
		Format: cfg.LogFormat,
	})
}

// GetConfig returns the global configuration
func GetConfig() *config.Config {
	return cfg
}

// GetLogger returns the global logger
func GetLogger() logger.Logger {
	return log
}
